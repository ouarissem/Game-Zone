<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Zone - بوابة الألعاب</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Tajawal', 'Cairo', sans-serif;
        }

        body {
            background-color: #0f1923;
            background-image: radial-gradient(circle, #1a2c3f 0%, #0f1923 100%);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow: hidden;
            position: relative;
        }

        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .particle {
            position: absolute;
            width: 5px;
            height: 5px;
            background-color: rgba(0, 255, 255, 0.5);
            border-radius: 50%;
            animation: float 8s infinite ease-in-out;
        }

        @keyframes float {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(50px);
                opacity: 0;
            }
        }

        .header {
            z-index: 1;
            text-align: center;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 90%;
            max-width: 800px;
        }

        .logo-text {
            font-size: 2.5rem;
            font-weight: bold;
            background: linear-gradient(90deg, #4deeea, #74efff);
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 10px rgba(77, 238, 234, 0.5);
        }

        .user-panel {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #4deeea, #74efff);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #0f1923;
            border: 2px solid #4deeea;
            box-shadow: 0 0 10px rgba(77, 238, 234, 0.5);
        }

        .login-btn, .logout-btn {
            background: linear-gradient(90deg, #4deeea, #74efff);
            border: none;
            color: #0f1923;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .login-btn:hover, .logout-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(77, 238, 234, 0.5);
        }

        .username {
            font-weight: bold;
            color: #4deeea;
        }

        .container {
            width: 90%;
            max-width: 800px;
            z-index: 1;
            position: relative;
        }

        /* تصميم صفحة تسجيل الدخول */
        .login-container {
            background: rgba(29, 36, 57, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px solid #4deeea;
            box-shadow: 0 0 20px #4deeea, 0 0 40px rgba(77, 238, 234, 0.3);
            padding: 30px;
            width: 100%;
            max-width: 500px;
            margin: 0 auto;
            z-index: 1;
            position: relative;
            display: none;
        }

        .login-container h2 {
            text-align: center;
            color: #4deeea;
            margin-bottom: 30px;
            font-size: 2.2rem;
            text-shadow: 0 0 10px #4deeea;
        }

        .input-group {
            margin-bottom: 25px;
            position: relative;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            color: #74efff;
            font-weight: bold;
            font-size: 1.1rem;
        }

        .input-group input {
            width: 100%;
            padding: 15px;
            background: rgba(14, 21, 37, 0.7);
            border: 2px solid #4deeea;
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .input-group input:focus {
            outline: none;
            box-shadow: 0 0 15px #4deeea;
            border-color: #74efff;
        }

        .error-msg {
            color: #ff4d6d;
            font-size: 0.9rem;
            margin-top: 8px;
            display: none;
        }

        .tabs {
            display: flex;
            margin-bottom: 20px;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            background: rgba(14, 21, 37, 0.7);
            color: #4deeea;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .tab:first-child {
            border-radius: 8px 0 0 8px;
        }

        .tab:last-child {
            border-radius: 0 8px 8px 0;
        }

        .tab.active {
            background: linear-gradient(90deg, #4deeea, #74efff);
            color: #0f1923;
            font-weight: bold;
        }

        .login-form, .register-form {
            display: none;
        }

        .login-form.active, .register-form.active {
            display: block;
        }

        .btn {
            width: 100%;
            padding: 15px;
            background: linear-gradient(90deg, #4deeea, #74efff);
            border: none;
            border-radius: 8px;
            color: #0f1923;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn:hover {
            background: linear-gradient(90deg, #74efff, #4deeea);
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(77, 238, 234, 0.5);
        }

        .btn:active {
            transform: translateY(0);
        }

        /* تصميم لعبة تجميع النقاط */
        .game-container {
            background: rgba(29, 36, 57, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px solid #4deeea;
            box-shadow: 0 0 20px #4deeea, 0 0 40px rgba(77, 238, 234, 0.3);
            padding: 20px;
            width: 100%;
            z-index: 1;
            position: relative;
            display: flex;
            flex-direction: column;
            align-items: center;
            display: none;
        }

        .game-info {
            display: flex;
            justify-content: space-between;
            width: 100%;
            margin-bottom: 20px;
        }

        .score, .time, .level, .high-score {
            background: rgba(14, 21, 37, 0.7);
            padding: 10px 15px;
            border-radius: 10px;
            border: 1px solid #4deeea;
            font-size: 1.1rem;
            min-width: 120px;
            text-align: center;
        }

        .game-field {
            width: 100%;
            height: 400px;
            background: rgba(14, 21, 37, 0.7);
            border-radius: 10px;
            border: 2px solid #4deeea;
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .target {
            position: absolute;
            width: 40px;
            height: 40px;
            background: radial-gradient(circle, #74efff, #4deeea);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #0f1923;
            box-shadow: 0 0 10px #4deeea, 0 0 20px rgba(77, 238, 234, 0.3);
            user-select: none;
        }

        .obstacle {
            position: absolute;
            background: radial-gradient(circle, #ff4d6d, #f43b5f);
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            color: #fff;
            box-shadow: 0 0 10px #ff4d6d, 0 0 20px rgba(255, 77, 109, 0.3);
            user-select: none;
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
            width: 100%;
        }

        .controls .btn {
            flex: 1;
            max-width: 150px;
            padding: 12px;
        }

        .btn.start {
            background: linear-gradient(90deg, #41e978, #38d168);
            max-width: 200px;
        }

        .btn.start:hover {
            background: linear-gradient(90deg, #38d168, #41e978);
        }

        .game-over, .splash {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(14, 21, 37, 0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 10px;
            z-index: 10;
        }

        .game-over h2, .splash h2 {
            font-size: 2.2rem;
            color: #4deeea;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #4deeea;
        }

        .game-over p, .splash p {
            font-size: 1.2rem;
            margin-bottom: 30px;
            text-align: center;
            line-height: 1.6;
        }

        .point-animation {
            position: absolute;
            font-size: 1.2rem;
            font-weight: bold;
            color: #4deeea;
            animation: pointFade 1s forwards;
            pointer-events: none;
        }

        @keyframes pointFade {
            0% {
                opacity: 1;
                transform: translateY(0);
            }
            100% {
                opacity: 0;
                transform: translateY(-50px);
            }
        }

        .instructions {
            margin-top: 20px;
            text-align: center;
            font-size: 1rem;
            color: #74efff;
            max-width: 600px;
        }

        .welcome-container {
            background: rgba(29, 36, 57, 0.8);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px solid #4deeea;
            box-shadow: 0 0 20px #4deeea, 0 0 40px rgba(77, 238, 234, 0.3);
            padding: 30px;
            width: 100%;
            text-align: center;
            z-index: 1;
        }

        .welcome-container h1 {
            color: #4deeea;
            font-size: 2.5rem;
            margin-bottom: 20px;
            text-shadow: 0 0 10px #4deeea;
        }

        .welcome-container p {
            color: #fff;
            font-size: 1.2rem;
            margin-bottom: 30px;
            line-height: 1.6;
        }

        .welcome-container .btn {
            max-width: 250px;
            margin: 0 auto;
        }

        .notification {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(29, 36, 57, 0.9);
            border: 2px solid #4deeea;
            border-radius: 8px;
            padding: 15px 25px;
            color: #4deeea;
            font-weight: bold;
            box-shadow: 0 0 20px rgba(77, 238, 234, 0.5);
            z-index: 100;
            display: none;
        }

        /* للشاشات الصغيرة */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }
            
            .game-info {
                flex-wrap: wrap;
                gap: 10px;
            }
            
            .score, .time, .level, .high-score {
                flex: 1;
                min-width: 100px;
            }
            
            .game-field {
                height: 350px;
            }
            
            .controls {
                flex-wrap: wrap;
            }
            
            .controls .btn {
                min-width: 120px;
            }
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>

    <div class="header">
        <div class="logo-text">GAME ZONE</div>
        <div class="user-panel" id="userPanel">
            <button class="login-btn" id="headerLoginBtn">تسجيل الدخول</button>
        </div>
    </div>

    <div class="container" id="mainContainer">
        <!-- صفحة الترحيب -->
        <div class="welcome-container" id="welcomeContainer">
            <h1>مرحباً بك في Game Zone!</h1>
            <p>استمتع بتجربة الألعاب المثيرة عبر منصتنا. سجل دخولك للوصول إلى اللعبة وحفظ تقدمك!</p>
            <button class="btn" id="welcomeLoginBtn">تسجيل الدخول للبدء</button>
        </div>
        
        <!-- نموذج تسجيل الدخول -->
        <div class="login-container" id="loginContainer">
            <h2>تسجيل الدخول</h2>
            
            <div class="tabs">
                <div class="tab active" id="loginTab">تسجيل الدخول</div>
                <div class="tab" id="registerTab">حساب جديد</div>
            </div>
            
            <!-- نموذج تسجيل الدخول -->
            <form class="login-form active" id="loginForm">
                <div class="input-group">
                    <label for="loginUsername">اسم المستخدم</label>
                    <input type="text" id="loginUsername" name="username" placeholder="أدخل اسم المستخدم" required>
                    <div class="error-msg" id="login-username-error">يرجى إدخال اسم مستخدم صالح</div>
                </div>
                
                <div class="input-group">
                    <label for="loginPassword">كلمة المرور</label>
                    <input type="password" id="loginPassword" name="password" placeholder="أدخل كلمة المرور" required>
                    <div class="error-msg" id="login-password-error">يرجى إدخال كلمة المرور</div>
                </div>
                
                <button type="submit" class="btn" id="loginSubmitBtn">دخول</button>
                <div class="error-msg" id="login-form-error">معلومات تسجيل الدخول غير صحيحة</div>
            </form>
            
            <!-- نموذج إنشاء حساب جديد -->
            <form class="register-form" id="registerForm">
                <div class="input-group">
                    <label for="registerUsername">اسم المستخدم</label>
                    <input type="text" id="registerUsername" name="username" placeholder="أدخل اسم المستخدم" required>
                    <div class="error-msg" id="register-username-error">يجب أن يحتوي اسم المستخدم على 3 أحرف على الأقل</div>
                </div>
                
                <div class="input-group">
                    <label for="registerEmail">البريد الإلكتروني</label>
                    <input type="email" id="registerEmail" name="email" placeholder="أدخل البريد الإلكتروني" required>
                    <div class="error-msg" id="register-email-error">يرجى إدخال بريد إلكتروني صالح</div>
                </div>
                
                <div class="input-group">
                    <label for="registerPassword">كلمة المرور</label>
                    <input type="password" id="registerPassword" name="password" placeholder="أدخل كلمة المرور" required>
                    <div class="error-msg" id="register-password-error">يجب أن تحتوي كلمة المرور على 6 أحرف على الأقل</div>
                </div>
                
                <button type="submit" class="btn" id="registerSubmitBtn">إنشاء حساب</button>
                <div class="error-msg" id="register-form-error">حدث خطأ أثناء إنشاء الحساب</div>
            </form>
        </div>
        
        <!-- لعبة تجميع النقاط -->
        <div class="game-container" id="gameContainer">
            <div class="game-info">
                <div class="score">النقاط: <span id="score">0</span></div>
                <div class="high-score">أعلى نتيجة: <span id="highScore">0</span></div>
                <div class="level">المستوى: <span id="level">1</span></div>
                <div class="time">الوقت: <span id="time">60</span></div>
            </div>

            <div class="game-field" id="gameField">
                <div class="splash" id="splash">
                    <div class="splash-content">
                        <h2>مرحبًا بك في Game Zone</h2>
                        <p>اجمع أكبر عدد من النقاط من خلال النقر على الكرات الزرقاء.<br>
                        تجنب الكرات الحمراء فهي ستخصم من نقاطك.<br>
                        لديك 60 ثانية، وكلما ارتفع مستواك زادت صعوبة اللعبة!
                        </p>
                        <button class="btn start" id="startBtn">ابدأ اللعبة</button>
                    </div>
                </div>

                <div class="game-over" id="gameOver" style="display: none;">
                    <h2>انتهت اللعبة!</h2>
                    <p>مجموع نقاطك: <span id="finalScore">0</span></p>
                    <p>المستوى النهائي: <span id="finalLevel">1</span></p>
                    <p>أعلى نتيجة: <span id="finalHighScore">0</span></p>
                    <button class="btn" id="playAgainBtn">العب مرة أخرى</button>
                </div>
            </div>

            <div class="controls">
                <button class="btn" id="pauseBtn">إيقاف مؤقت</button>
                <button class="btn" id="restartBtn">إعادة التشغيل</button>
                <button class="btn" id="saveBtn">حفظ اللعبة</button>
            </div>

            <div class="instructions">
                انقر على الكرات الزرقاء لتجميع النقاط وتجنب الكرات الحمراء.
                كلما ارتفع مستواك، ستزداد سرعة الكرات وعددها!
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // المتغيرات العامة
        let currentUser = null;
        let users = JSON.parse(localStorage.getItem('gameZoneUsers')) || [];
        
        // متغيرات اللعبة
        let score = 0;
        let level = 1;
        let timeLeft = 60;
        let gameInterval;
        let timerInterval;
        let isPaused = false;
        let isGameOver = false;
        let targetSpeed = 1500; // سرعة الأهداف بالمللي ثانية
        let obstacleSpeed = 2000; // سرعة العوائق بالمللي ثانية
        let targetCount = 3; // عدد الأهداف البداية
        let obstacleCount = 1; // عدد العوائق البداية
        let highScore = 0;
        let autoSaveInterval;
        
        // العناصر المرجعية
        const welcomeContainer = document.getElementById('welcomeContainer');
        const loginContainer = document.getElementById('loginContainer');
        const gameContainer = document.getElementById('gameContainer');
        const headerLoginBtn = document.getElementById('headerLoginBtn');
        const welcomeLoginBtn = document.getElementById('welcomeLoginBtn');
        const userPanel = document.getElementById('userPanel');
        const loginTab = document.getElementById('loginTab');
        const registerTab = document.getElementById('registerTab');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const notification = document.getElementById('notification');
        
        // عناصر اللعبة
        const gameField = document.getElementById('gameField');
        const scoreDisplay = document.getElementById('score');
        const levelDisplay = document.getElementById('level');
        const timeDisplay = document.getElementById('time');
        const highScoreDisplay = document.getElementById('highScore');
        const finalScoreDisplay = document.getElementById('finalScore');
        const finalLevelDisplay = document.getElementById('finalLevel');
        const finalHighScoreDisplay = document.getElementById('finalHighScore');
        const pauseBtn = document.getElementById('pauseBtn');
        const restartBtn = document.getElementById('restartBtn');
        const saveBtn = document.getElementById('saveBtn');
        const gameOverScreen = document.getElementById('gameOver');
        const playAgainBtn = document.getElementById('playAgainBtn');
        const splashScreen = document.getElementById('splash');
        const startBtn = document.getElementById('startBtn');
        
        // إنشاء جزيئات متحركة في الخلفية
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            const particleCount = 50;
            
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.classList.add('particle');
                
                // تحديد موضع عشوائي
                const posX = Math.random() * 100;
                const posY = Math.random() * 100;
                const size = Math.random() * 5 + 2;
                const duration = Math.random() * 8 + 4;
                const delay = Math.random() * 5;
                
                particle.style.left = `${posX}%`;
                particle.style.bottom = `${posY}%`;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.animationDuration = `${duration}s`;
                particle.style.animationDelay = `${delay}s`;
                particle.style.opacity = Math.random() * 0.5 + 0.1;
                
                particlesContainer.appendChild(particle);
            }
        }
        
        // التبديل بين نماذج تسجيل الدخول والتسجيل الجديد
        loginTab.addEventListener('click', () => {
            loginTab.classList.add('active');
            registerTab.classList.remove('active');
            loginForm.classList.add('active');
            registerForm.classList.remove('active');
        });
        
        registerTab.addEventListener('click', () => {
            registerTab.classList.add('active');
            loginTab.classList.remove('active');
            registerForm.classList.add('active');
            loginForm.classList.remove('active');
        });
        
        // التبديل إلى صفحة تسجيل الدخول
        headerLoginBtn.addEventListener('click', showLoginForm);
        welcomeLoginBtn.addEventListener('click', showLoginForm);
        
        function showLoginForm() {
            welcomeContainer.style.display = 'none';
            loginContainer.style.display = 'block';
            gameContainer.style.display = 'none';
        }
        
        // إظهار إشعار
        function showNotification(message, duration = 3000) {
            notification.textContent = message;
            notification.style.display = 'block';
            
            setTimeout(() => {
                notification.style.display = 'none';
            }, duration);
        }
        
        // التحقق من النموذج
        function validateLoginForm() {
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            let isValid = true;
            
            if (!username) {
                document.getElementById('login-username-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('login-username-error').style.display = 'none';
            }
            
            if (!password) {
                document.getElementById('login-password-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('login-password-error').style.display = 'none';
            }
            
            return isValid;
        }
        
        function validateRegisterForm() {
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            let isValid = true;
            
            if (!username || username.length < 3) {
                document.getElementById('register-username-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('register-username-error').style.display = 'none';
            }
            
            if (!email || !email.includes('@') || !email.includes('.')) {
                document.getElementById('register-email-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('register-email-error').style.display = 'none';
            }
            
            if (!password || password.length < 6) {
                document.getElementById('register-password-error').style.display = 'block';
                isValid = false;
            } else {
                document.getElementById('register-password-error').style.display = 'none';
            }
            
            return isValid;
        }
        
        // تسجيل الدخول
        loginForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateLoginForm()) return;
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            
            // البحث عن المستخدم
            const user = users.find(u => u.username === username && u.password === password);
            
            if (user) {
                // تسجيل الدخول بنجاح
                currentUser = user;
                localStorage.setItem('gameZoneCurrentUser', JSON.stringify(user));
                
                // تحديث واجهة المستخدم
                updateUserPanel();
                
                // تحميل بيانات اللعبة المحفوظة
                loadUserGameData();
                
                // الانتقال إلى اللعبة
                showGameScreen();
                
                showNotification(`مرحباً بك ${username}! تم تسجيل دخولك بنجاح.`);
            } else {
                // خطأ في تسجيل الدخول
                document.getElementById('login-form-error').style.display = 'block';
            }
        });
        
        // إنشاء حساب جديد
        registerForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            if (!validateRegisterForm()) return;
            
            const username = document.getElementById('registerUsername').value;
            const email = document.getElementById('registerEmail').value;
            const password = document.getElementById('registerPassword').value;
            
            // التحقق ما إذا كان اسم المستخدم موجودًا بالفعل
            if (users.some(u => u.username === username)) {
                document.getElementById('register-form-error').textContent = 'اسم المستخدم مستخدم بالفعل';
                document.getElementById('register-form-error').style.display = 'block';
                return;
            }
            
            // إنشاء مستخدم جديد
            const newUser = {
                username,
                email,
                password,
                highScore: 0,
                savedGames: []
            };
            
            users.push(newUser);
            localStorage.setItem('gameZoneUsers', JSON.stringify(users));
            
            // تسجيل دخول المستخدم الجديد تلقائيًا
            currentUser = newUser;
            localStorage.setItem('gameZoneCurrentUser', JSON.stringify(newUser));
            
            // تحديث واجهة المستخدم
            updateUserPanel();
            
            // الانتقال إلى اللعبة
            showGameScreen();
            
            showNotification(`مرحباً بك ${username}! تم إنشاء حسابك بنجاح.`);
        });

        // تحديث لوحة المستخدم
        function updateUserPanel() {
            userPanel.innerHTML = '';
            
            if (currentUser) {
                const userAvatar = document.createElement('div');
                userAvatar.className = 'user-avatar';
                userAvatar.textContent = currentUser.username.charAt(0).toUpperCase();
                
                const username = document.createElement('div');
                username.className = 'username';
                username.textContent = currentUser.username;
                
                const logoutBtn = document.createElement('button');
                logoutBtn.className = 'logout-btn';
                logoutBtn.textContent = 'تسجيل الخروج';
                logoutBtn.addEventListener('click', logout);
                
                userPanel.append(userAvatar, username, logoutBtn);
            } else {
                const loginBtn = document.createElement('button');
                loginBtn.className = 'login-btn';
                loginBtn.id = 'headerLoginBtn';
                loginBtn.textContent = 'تسجيل الدخول';
                loginBtn.addEventListener('click', showLoginForm);
                
                userPanel.appendChild(loginBtn);
            }
        }

        // تسجيل الخروج
        function logout() {
            currentUser = null;
            localStorage.removeItem('gameZoneCurrentUser');
            updateUserPanel();
            resetGame();
            saveBtn.disabled = true;
            showWelcomeScreen();
            showNotification('تم تسجيل الخروج بنجاح.');
        }

        // عرض شاشة الترحيب
        function showWelcomeScreen() {
            welcomeContainer.style.display = 'block';
            loginContainer.style.display = 'none';
            gameContainer.style.display = 'none';
        }

        // عرض شاشة اللعبة
        function showGameScreen() {
            welcomeContainer.style.display = 'none';
            loginContainer.style.display = 'none';
            gameContainer.style.display = 'block';
            
            // تحديث أعلى نتيجة
            if (currentUser) {
                highScore = currentUser.highScore || 0;
                highScoreDisplay.textContent = highScore;
            }
        }

        // تحميل بيانات اللعبة للمستخدم
        function loadUserGameData() {
            if (currentUser) {
                highScore = currentUser.highScore || 0;
                highScoreDisplay.textContent = highScore;
                finalHighScoreDisplay.textContent = highScore;
            }
        }

        // حفظ بيانات اللعبة للمستخدم
        function saveUserGameData() {
            if (!currentUser) return;
            
            // تحديث أعلى نتيجة إذا كانت النتيجة الحالية أعلى
            if (score > highScore) {
                highScore = score;
                currentUser.highScore = highScore;
            }
            
            // حفظ حالة اللعبة الحالية
            const gameState = {
                score,
                level,
                timeLeft,
                date: new Date().toISOString()
            };
            
            // حفظ آخر 5 ألعاب فقط
            currentUser.savedGames = currentUser.savedGames || [];
            currentUser.savedGames.unshift(gameState);
            if (currentUser.savedGames.length > 5) {
                currentUser.savedGames = currentUser.savedGames.slice(0, 5);
            }
            
            // تحديث المستخدم في قائمة المستخدمين
            const userIndex = users.findIndex(u => u.username === currentUser.username);
            if (userIndex !== -1) {
                users[userIndex] = currentUser;
            }
            
            // حفظ البيانات
            localStorage.setItem('gameZoneUsers', JSON.stringify(users));
            localStorage.setItem('gameZoneCurrentUser', JSON.stringify(currentUser));
            
            showNotification('تم حفظ حالة اللعبة بنجاح.');
        }

        // بدء اللعبة
        function startGame() {
            if (isGameOver) resetGame();
            isGameOver = false;
            isPaused = false;
            
            // إخفاء شاشة البداية
            splashScreen.style.display = 'none';
            gameOverScreen.style.display = 'none';
            
            // تحديث قيم اللعبة
            score = 0;
            level = 1;
            timeLeft = 60;
            updateGameUI();
            
            // بدء العد التنازلي
            startTimer();
            
            // إنشاء الأهداف والعوائق
            createTargets();
            createObstacles();
            
            // بدء الحفظ التلقائي إذا كان المستخدم مسجلًا
            if (currentUser) {
                autoSaveInterval = setInterval(() => {
                    saveUserGameData();
                }, 30000); // حفظ كل 30 ثانية
            }
            
            // تمكين أزرار التحكم
            pauseBtn.disabled = false;
            restartBtn.disabled = false;
            saveBtn.disabled = currentUser ? false : true;
        }

        // إيقاف اللعبة مؤقتًا
        function pauseGame() {
            if (isGameOver) return;
            
            if (isPaused) {
                // استئناف اللعبة
                isPaused = false;
                pauseBtn.textContent = 'إيقاف مؤقت';
                
                startTimer();
                resumeTargetsAndObstacles();
            } else {
                // إيقاف اللعبة مؤقتًا
                isPaused = true;
                pauseBtn.textContent = 'استئناف';
                
                clearInterval(timerInterval);
                pauseTargetsAndObstacles();
            }
        }

        // إعادة تشغيل اللعبة
        function resetGame() {
            // إيقاف العدادات
            clearInterval(timerInterval);
            clearInterval(autoSaveInterval);
            
            // إزالة جميع الأهداف والعوائق
            removeAllTargetsAndObstacles();
            
            // إعادة تعيين قيم اللعبة
            score = 0;
            level = 1;
            timeLeft = 60;
            isGameOver = true;
            isPaused = false;
            updateGameUI();
            
            // إظهار شاشة البداية
            splashScreen.style.display = 'flex';
            gameOverScreen.style.display = 'none';
            
            // تعطيل أزرار التحكم
            pauseBtn.disabled = true;
            saveBtn.disabled = true;
        }

        // بدء العد التنازلي
        function startTimer() {
            clearInterval(timerInterval);
            
            timerInterval = setInterval(() => {
                timeLeft--;
                timeDisplay.textContent = timeLeft;
                
                if (timeLeft <= 0) {
                    endGame();
                }
            }, 1000);
        }

        // إنهاء اللعبة
        function endGame() {
            clearInterval(timerInterval);
            clearInterval(autoSaveInterval);
            
            isGameOver = true;
            
            // إيقاف وإزالة جميع الأهداف والعوائق
            removeAllTargetsAndObstacles();
            
            // تحديث أعلى نتيجة
            if (score > highScore) {
                highScore = score;
                highScoreDisplay.textContent = highScore;
                
                if (currentUser) {
                    currentUser.highScore = highScore;
                    
                    // تحديث المستخدم في قائمة المستخدمين
                    const userIndex = users.findIndex(u => u.username === currentUser.username);
                    if (userIndex !== -1) {
                        users[userIndex] = currentUser;
                    }
                    
                    localStorage.setItem('gameZoneUsers', JSON.stringify(users));
                    localStorage.setItem('gameZoneCurrentUser', JSON.stringify(currentUser));
                }
            }
            
            // عرض شاشة انتهاء اللعبة
            finalScoreDisplay.textContent = score;
            finalLevelDisplay.textContent = level;
            finalHighScoreDisplay.textContent = highScore;
            gameOverScreen.style.display = 'flex';
            
            // تعطيل أزرار التحكم
            pauseBtn.disabled = true;
        }

        // تحديث واجهة اللعبة
        function updateGameUI() {
            scoreDisplay.textContent = score;
            levelDisplay.textContent = level;
            timeDisplay.textContent = timeLeft;
            highScoreDisplay.textContent = highScore;
        }

        // إنشاء الأهداف
        function createTargets() {
            // تحديد عدد الأهداف بناءً على المستوى
            const numTargets = targetCount + Math.floor(level / 2);
            
            for (let i = 0; i < numTargets; i++) {
                createTarget();
            }
        }

        // إنشاء هدف واحد
        function createTarget() {
            const target = document.createElement('div');
            target.className = 'target';
            target.textContent = '+1';
            
            // تحديد حجم عشوائي (أصغر في المستويات العليا)
            const size = Math.max(25, 40 - level * 2);
            target.style.width = `${size}px`;
            target.style.height = `${size}px`;
            
            // تحديد موضع عشوائي
            positionElement(target);
            
            // إضافة معالج النقر
            target.addEventListener('click', () => {
                if (isPaused) return;
                
                // زيادة النقاط
                score++;
                
                // عرض رسوم متحركة للنقاط
                showPointAnimation('+1', target);
                
                // إزالة الهدف
                gameField.removeChild(target);
                
                // تحديث المستوى
                if (score % 10 === 0) {
                    levelUp();
                }
                
                // تحديث واجهة اللعبة
                updateGameUI();
                
                // إنشاء هدف جديد
                setTimeout(createTarget, 500);
            });
            
            // إضافة الهدف إلى حقل اللعبة
            gameField.appendChild(target);
            
            // تحريك الهدف
            moveElement(target, targetSpeed - (level * 100));
        }

        // إنشاء العوائق
        function createObstacles() {
            // تحديد عدد العوائق بناءً على المستوى
            const numObstacles = obstacleCount + Math.floor(level / 3);
            
            for (let i = 0; i < numObstacles; i++) {
                createObstacle();
            }
        }

        // إنشاء عائق واحد
        function createObstacle() {
            const obstacle = document.createElement('div');
            obstacle.className = 'obstacle';
            obstacle.textContent = '-2';
            
            // تحديد حجم عشوائي (أكبر في المستويات العليا)
            const size = Math.min(45, 30 + level * 2);
            obstacle.style.width = `${size}px`;
            obstacle.style.height = `${size}px`;
            
            // تحديد موضع عشوائي
            positionElement(obstacle);
            
            // إضافة معالج النقر
            obstacle.addEventListener('click', () => {
                if (isPaused) return;
                
                // خصم النقاط
                score = Math.max(0, score - 2);
                
                // عرض رسوم متحركة للنقاط
                showPointAnimation('-2', obstacle);
                
                // إزالة العائق
                gameField.removeChild(obstacle);
                
                // تحديث واجهة اللعبة
                updateGameUI();
                
                // إنشاء عائق جديد
                setTimeout(createObstacle, 1000);
            });
            
            // إضافة العائق إلى حقل اللعبة
            gameField.appendChild(obstacle);
            
            // تحريك العائق
            moveElement(obstacle, obstacleSpeed - (level * 100));
        }

        // تحديد موضع عشوائي للعنصر
        function positionElement(element) {
            const fieldRect = gameField.getBoundingClientRect();
            const elementSize = parseInt(element.style.width) || 40;
            
            const maxX = fieldRect.width - elementSize;
            const maxY = fieldRect.height - elementSize;
            
            const randomX = Math.floor(Math.random() * maxX);
            const randomY = Math.floor(Math.random() * maxY);
            
            element.style.left = `${randomX}px`;
            element.style.top = `${randomY}px`;
        }

        // تحريك العنصر في حقل اللعبة
        function moveElement(element, speed) {
            const fieldRect = gameField.getBoundingClientRect();
            const elementSize = parseInt(element.style.width) || 40;
            
            const maxX = fieldRect.width - elementSize;
            const maxY = fieldRect.height - elementSize;
            
            const randomMove = () => {
                if (isGameOver || !element.isConnected) return;
                if (isPaused) {
                    element.moveTimeout = setTimeout(randomMove, speed);
                    return;
                }
                
                const currentX = parseInt(element.style.left) || 0;
                const currentY = parseInt(element.style.top) || 0;
                
                // تحديد اتجاه عشوائي
                let newX = currentX + (Math.random() * 100 - 50);
                let newY = currentY + (Math.random() * 100 - 50);
                
                // التأكد من بقاء العنصر داخل حدود اللعبة
                newX = Math.max(0, Math.min(maxX, newX));
                newY = Math.max(0, Math.min(maxY, newY));
                
                // تحريك العنصر بنعومة
                element.style.transition = `left ${speed / 1000}s, top ${speed / 1000}s`;
                element.style.left = `${newX}px`;
                element.style.top = `${newY}px`;
                
                // جدولة الحركة التالية
                element.moveTimeout = setTimeout(randomMove, speed);
            };
            
            // بدء الحركة
            randomMove();
        }

        // عرض رسوم متحركة للنقاط
        function showPointAnimation(value, sourceElement) {
            const animation = document.createElement('div');
            animation.className = 'point-animation';
            animation.textContent = value;
            
            // تحديد موضع الرسوم المتحركة
            const rect = sourceElement.getBoundingClientRect();
            const fieldRect = gameField.getBoundingClientRect();
            
            const left = rect.left - fieldRect.left + rect.width / 2;
            const top = rect.top - fieldRect.top;
            
            animation.style.left = `${left}px`;
            animation.style.top = `${top}px`;
            
            // إضافة الرسوم المتحركة إلى حقل اللعبة
            gameField.appendChild(animation);
            
            // إزالة الرسوم المتحركة بعد انتهاء المدة
            setTimeout(() => {
                if (animation.parentNode === gameField) {
                    gameField.removeChild(animation);
                }
            }, 1000);
        }

        // زيادة المستوى
        function levelUp() {
            level++;
            
            // زيادة الوقت
            timeLeft += 5;
            
            // تحديث صعوبة اللعبة
            targetSpeed = Math.max(500, 1500 - level * 50);
            obstacleSpeed = Math.max(800, 2000 - level * 50);
            
            // تحديث واجهة المستوى
            updateGameUI();
            
            // عرض رسوم متحركة للمستوى الجديد
            showLevelUpAnimation();
        }

        // عرض رسوم متحركة للمستوى الجديد
        function showLevelUpAnimation() {
            const animation = document.createElement('div');
            animation.className = 'point-animation';
            animation.textContent = `المستوى ${level}!`;
            animation.style.fontSize = '1.5rem';
            animation.style.color = '#41e978';
            
            // تحديد موضع وسط الشاشة
            const fieldRect = gameField.getBoundingClientRect();
            animation.style.left = `${fieldRect.width / 2 - 50}px`;
            animation.style.top = `${fieldRect.height / 2 - 20}px`;
            
            // إضافة الرسوم المتحركة إلى حقل اللعبة
            gameField.appendChild(animation);
            
            // إزالة الرسوم المتحركة بعد انتهاء المدة
            setTimeout(() => {
                if (animation.parentNode === gameField) {
                    gameField.removeChild(animation);
                }
            }, 1500);
        }

        // إيقاف جميع الأهداف والعوائق مؤقتًا
        function pauseTargetsAndObstacles() {
            const elements = document.querySelectorAll('.target, .obstacle');
            elements.forEach(element => {
                element.style.transition = 'none';
            });
        }

        // استئناف حركة الأهداف والعوائق
        function resumeTargetsAndObstacles() {
            const targets = document.querySelectorAll('.target');
            const obstacles = document.querySelectorAll('.obstacle');
            
            targets.forEach(target => {
                moveElement(target, targetSpeed - (level * 100));
            });
            
            obstacles.forEach(obstacle => {
                moveElement(obstacle, obstacleSpeed - (level * 100));
            });
        }

        // إزالة جميع الأهداف والعوائق
        function removeAllTargetsAndObstacles() {
            const elements = document.querySelectorAll('.target, .obstacle');
            elements.forEach(element => {
                clearTimeout(element.moveTimeout);
                if (element.parentNode === gameField) {
                    gameField.removeChild(element);
                }
            });
        }

        // إضافة مستمعي الأحداث لأزرار التحكم
        startBtn.addEventListener('click', startGame);
        pauseBtn.addEventListener('click', pauseGame);
        restartBtn.addEventListener('click', resetGame);
        playAgainBtn.addEventListener('click', startGame);
        saveBtn.addEventListener('click', saveUserGameData);

        // التحقق مما إذا كان هناك مستخدم حالي محفوظ
        function checkCurrentUser() {
            const savedUser = JSON.parse(localStorage.getItem('gameZoneCurrentUser'));
            if (savedUser) {
                currentUser = savedUser;
                updateUserPanel();
                showGameScreen();
                loadUserGameData();
            }
        }

        // تهيئة التطبيق
        function init() {
            createParticles();
            checkCurrentUser();
            
            // تعطيل أزرار التحكم في البداية
            pauseBtn.disabled = true;
            restartBtn.disabled = true;
            saveBtn.disabled = true;
        }

        // بدء التطبيق
        init();
    </script>
</body>
</html>